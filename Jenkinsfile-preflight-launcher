// ECS builds on o03-cot, Azure builds on c12-cot
isAzure = env.JENKINS_URL.contains('c12-cot') as boolean

GITHUB_ORG_NAME = 'media-and-entertainment'
PROJECT_NAME = 'ecg-maya-usd'
TOP_FOLDER = isAzure ? 'EMS/ECG' : 'ECP'
DISPATCH_POOL = isAzure ? 'az-cot-dispatch-linux-rocky-8-intel-nogpu-prod' : 'mayausd-preload-pool'
JOB_NAME = isAzure ? 'health/update-submodule-master' : 'ecg-mayausd-preflight-update-submodule-master'

pipeline {
    agent {
        label "${DISPATCH_POOL}"
    }
    stages {
        stage('Triggering Preflight Update Submodule') {
            steps {
                sh 'env|sort'
                script {
                        build(
                            job: "${TOP_FOLDER}/${PROJECT_NAME}/${JOB_NAME}",
                            parameters: [
                                string(name:'DISABLE_MAIL_NOTIFICATIONS', value:'ON')
                            ],
                            wait: false,
                            propagate: false
                        )
                }
            }
        }
    }
    post {
        failure {
            emailext body: 'Jenkins job failed, please investigate.', subject: "${env.JOB_NAME} - Build # ${env.BUILD_NUMBER} - FAILURE!", to: 'ecp.maya.usd.build@autodesk.com', from: 'ecg.jenkins@autodesk.com'
        }
    }
}
